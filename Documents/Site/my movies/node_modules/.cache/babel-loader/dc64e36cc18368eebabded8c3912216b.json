{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Client = exports.search = exports.get = exports.ImdbError = exports.SearchResults = exports.SearchResult = exports.Game = exports.TVShow = exports.Episode = exports.Movie = exports.Rating = void 0;\n\nvar ky = require(\"ky-universal\");\n\nvar url_1 = require(\"url\");\n\nvar interfaces_1 = require(\"./interfaces\");\n\nvar omdbapi = \"https://www.omdbapi.com\";\n\nfunction reqtoqueryobj(req, apikey, page) {\n  var r = new url_1.URLSearchParams({\n    apikey: apikey,\n    s: req.name,\n    page: String(page),\n    r: \"json\"\n  });\n\n  if (req.year !== undefined) {\n    r.append(\"y\", String(req.year));\n  }\n\n  if (req.reqtype !== undefined) {\n    r.append(\"type\", String(req.reqtype));\n  }\n\n  return r;\n}\n\nvar transTable = {\n  Genre: \"genres\",\n  Language: \"languages\",\n  imdbRating: \"rating\",\n  imdbVotes: \"votes\"\n};\n\nvar Rating = function () {\n  function Rating() {}\n\n  return Rating;\n}();\n\nexports.Rating = Rating;\n\nvar Movie = function () {\n  function Movie(obj) {\n    this.ratings = [];\n\n    for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n      var attr = _a[_i];\n\n      if (attr === \"Year\") {\n        this._yearData = obj[attr];\n\n        if (!obj[attr].match(/\\d{4}[-â€“](?:\\d{4})?/)) {\n          var val = parseInt(obj[attr], 10);\n\n          if (isNaN(val)) {\n            throw new TypeError(\"invalid year\");\n          }\n\n          this[attr.toLowerCase()] = val;\n        }\n      } else if (attr === \"Released\") {\n        var val = new Date(obj[attr]);\n\n        if (isNaN(val.getTime())) {\n          this.released = undefined;\n        } else {\n          this.released = val;\n        }\n      } else if (attr === \"DVD\") {\n        var val = new Date(obj[attr]);\n\n        if (isNaN(val.getTime())) {\n          this.dvd = undefined;\n        } else {\n          this.dvd = val;\n        }\n      } else if (attr === \"imdbRating\") {\n        var key = transTable[attr];\n        var val = parseFloat(obj[attr]);\n        this[key] = isNaN(val) ? 0 : val;\n      } else if (transTable[attr] !== undefined) {\n        this[transTable[attr]] = obj[attr];\n      } else if (attr === \"Ratings\") {\n        for (var _b = 0, _c = obj[attr]; _b < _c.length; _b++) {\n          var rating = _c[_b];\n          this.ratings.push({\n            source: rating.Source,\n            value: rating.Value\n          });\n        }\n      } else {\n        this[attr.toLowerCase()] = obj[attr];\n      }\n    }\n\n    this.name = this.title;\n    this.series = this.type !== \"movie\";\n    this.imdburl = \"https://www.imdb.com/title/\" + this.imdbid;\n  }\n\n  return Movie;\n}();\n\nexports.Movie = Movie;\n\nvar Episode = function (_super) {\n  __extends(Episode, _super);\n\n  function Episode(obj, season) {\n    var _this = _super.call(this, obj) || this;\n\n    if (season !== undefined) {\n      _this.season = season;\n    } else {\n      _this.season = parseInt(obj.Season, 10);\n\n      if (isNaN(_this.season)) {\n        throw new TypeError(\"invalid season\");\n      }\n    }\n\n    if (Object.prototype.hasOwnProperty.call(obj, \"Episode\")) {\n      _this.episode = parseInt(obj.Episode, 10);\n\n      if (isNaN(_this.episode)) {\n        throw new TypeError(\"invalid episode\");\n      }\n    }\n\n    return _this;\n  }\n\n  return Episode;\n}(Movie);\n\nexports.Episode = Episode;\n\nvar TVShow = function (_super) {\n  __extends(TVShow, _super);\n\n  function TVShow(obj, opts) {\n    var _this = _super.call(this, obj) || this;\n\n    _this._episodes = [];\n\n    var years = _this._yearData.split(\"-\");\n\n    _this.start_year = parseInt(years[0], 10);\n    _this.end_year = parseInt(years[1], 10) ? parseInt(years[1], 10) : undefined;\n    _this.totalseasons = parseInt(obj.totalSeasons, 10);\n    _this.opts = opts;\n    return _this;\n  }\n\n  TVShow.prototype.episodes = function () {\n    if (this._episodes.length !== 0) {\n      return Promise.resolve(this._episodes);\n    }\n\n    var tvShow = this;\n    var funcs = [];\n\n    for (var i = 1; i <= tvShow.totalseasons; i++) {\n      var reqopts = {\n        searchParams: {\n          Season: i,\n          apikey: tvShow.opts.apiKey,\n          i: tvShow.imdbid,\n          r: \"json\"\n        },\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        timeout: undefined\n      };\n\n      if (\"timeout\" in this.opts) {\n        reqopts.timeout = this.opts.timeout;\n      }\n\n      funcs.push(ky(omdbapi, reqopts).json());\n    }\n\n    var prom = Promise.all(funcs).then(function (epData) {\n      var eps = [];\n\n      for (var _i = 0, epData_1 = epData; _i < epData_1.length; _i++) {\n        var datum = epData_1[_i];\n\n        if (interfaces_1.isError(datum)) {\n          throw new ImdbError(datum.Error);\n        }\n\n        var season = parseInt(datum.Season, 10);\n\n        for (var _a = 0, _b = Object.getOwnPropertyNames(datum.Episodes); _a < _b.length; _a++) {\n          var ep = _b[_a];\n          eps.push(new Episode(datum.Episodes[ep], season));\n        }\n      }\n\n      tvShow._episodes = eps;\n      return Promise.resolve(eps);\n    });\n    return prom;\n  };\n\n  return TVShow;\n}(Movie);\n\nexports.TVShow = TVShow;\n\nvar Game = function (_super) {\n  __extends(Game, _super);\n\n  function Game() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return Game;\n}(Movie);\n\nexports.Game = Game;\n\nvar SearchResult = function () {\n  function SearchResult(obj) {\n    for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n      var attr = _a[_i];\n\n      if (attr === \"Year\") {\n        this[attr.toLowerCase()] = parseInt(obj[attr], 10);\n      } else {\n        this[attr.toLowerCase()] = obj[attr];\n      }\n    }\n\n    this.name = this.title;\n  }\n\n  return SearchResult;\n}();\n\nexports.SearchResult = SearchResult;\n\nvar SearchResults = function () {\n  function SearchResults(obj, page, opts, req) {\n    this.results = [];\n    this.page = page;\n    this.req = req;\n    this.opts = opts;\n\n    for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n      var attr = _a[_i];\n\n      if (attr === \"Search\") {\n        for (var _b = 0, _c = obj.Search; _b < _c.length; _b++) {\n          var result = _c[_b];\n          this.results.push(new SearchResult(result));\n        }\n      } else if (attr === \"totalResults\") {\n        this[attr.toLowerCase()] = parseInt(obj[attr], 10);\n      } else {\n        this[attr.toLowerCase()] = obj[attr];\n      }\n    }\n  }\n\n  SearchResults.prototype.next = function () {\n    return search(this.req, this.opts, this.page + 1);\n  };\n\n  return SearchResults;\n}();\n\nexports.SearchResults = SearchResults;\n\nvar ImdbError = function () {\n  function ImdbError(message) {\n    this.message = message;\n    this.name = \"imdb api error\";\n  }\n\n  return ImdbError;\n}();\n\nexports.ImdbError = ImdbError;\n\nfunction get(req, opts) {\n  try {\n    return new Client(opts).get(req);\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nexports.get = get;\n\nfunction search(req, opts, page) {\n  return new Client(opts).search(req, page);\n}\n\nexports.search = search;\n\nvar Client = function () {\n  function Client(opts) {\n    if (!Object.prototype.hasOwnProperty.call(opts, \"apiKey\")) {\n      throw new ImdbError(\"Missing api key in opts\");\n    }\n\n    this.opts = opts;\n  }\n\n  Client.prototype.get = function (req, opts) {\n    opts = this.mergeOpts(opts);\n    var qs = [[\"apikey\", opts.apiKey], [\"plot\", req.short_plot ? \"short\" : \"full\"], [\"r\", \"json\"]];\n\n    if (req.year !== undefined) {\n      qs.push([\"y\", String(req.year)]);\n    }\n\n    if (req.name) {\n      qs.push([\"t\", req.name]);\n    } else if (req.id) {\n      qs.push([\"i\", req.id]);\n    } else {\n      return Promise.reject(new ImdbError(\"Missing one of req.id or req.name\"));\n    }\n\n    var reqopts = {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      searchParams: qs,\n      timeout: undefined\n    };\n\n    if (\"timeout\" in opts) {\n      reqopts.timeout = opts.timeout;\n    }\n\n    var prom = ky(omdbapi, reqopts).json().then(function (data) {\n      var ret;\n\n      if (interfaces_1.isError(data)) {\n        throw new ImdbError(data.Error + \": \" + (req.name ? req.name : req.id));\n      }\n\n      if (interfaces_1.isMovie(data)) {\n        ret = new Movie(data);\n      } else if (interfaces_1.isGame(data)) {\n        ret = new Game(data);\n      } else if (interfaces_1.isTvshow(data)) {\n        ret = new TVShow(data, opts);\n      } else if (interfaces_1.isEpisode(data)) {\n        ret = new Episode(data);\n      } else {\n        throw new ImdbError(\"type: '\" + data.Type + \"' is not valid\");\n      }\n\n      return Promise.resolve(ret);\n    });\n    return prom;\n  };\n\n  Client.prototype.search = function (req, page, opts) {\n    opts = this.mergeOpts(opts);\n\n    if (page === undefined) {\n      page = 1;\n    }\n\n    var qs = reqtoqueryobj(req, opts.apiKey, page);\n    var reqopts = {\n      searchParams: qs,\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      timeout: undefined\n    };\n\n    if (\"timeout\" in opts) {\n      reqopts.timeout = opts.timeout;\n    }\n\n    var prom = ky(omdbapi, reqopts).json().then(function (data) {\n      if (interfaces_1.isError(data)) {\n        throw new ImdbError(data.Error + \": \" + req.name);\n      }\n\n      return Promise.resolve(new SearchResults(data, page, opts, req));\n    });\n    return prom;\n  };\n\n  Client.prototype.mergeOpts = function (opts) {\n    if (opts !== undefined) {\n      return __assign(__assign({}, this.opts), opts);\n    }\n\n    return __assign({}, this.opts);\n  };\n\n  return Client;\n}();\n\nexports.Client = Client;","map":{"version":3,"sources":["../src/imdb.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Client = exports.search = exports.get = exports.ImdbError = exports.SearchResults = exports.SearchResult = exports.Game = exports.TVShow = exports.Episode = exports.Movie = exports.Rating = void 0;\nvar ky = require(\"ky-universal\");\nvar url_1 = require(\"url\");\nvar interfaces_1 = require(\"./interfaces\");\nvar omdbapi = \"https://www.omdbapi.com\";\nfunction reqtoqueryobj(req, apikey, page) {\n    var r = new url_1.URLSearchParams({\n        apikey: apikey,\n        s: req.name,\n        page: String(page),\n        r: \"json\",\n    });\n    if (req.year !== undefined) {\n        r.append(\"y\", String(req.year));\n    }\n    if (req.reqtype !== undefined) {\n        r.append(\"type\", String(req.reqtype));\n    }\n    return r;\n}\nvar transTable = {\n    Genre: \"genres\",\n    Language: \"languages\",\n    imdbRating: \"rating\",\n    imdbVotes: \"votes\",\n};\nvar Rating = (function () {\n    function Rating() {\n    }\n    return Rating;\n}());\nexports.Rating = Rating;\nvar Movie = (function () {\n    function Movie(obj) {\n        this.ratings = [];\n        for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n            var attr = _a[_i];\n            if (attr === \"Year\") {\n                this._yearData = obj[attr];\n                if (!obj[attr].match(/\\d{4}[-â€“](?:\\d{4})?/)) {\n                    var val = parseInt(obj[attr], 10);\n                    if (isNaN(val)) {\n                        throw new TypeError(\"invalid year\");\n                    }\n                    this[attr.toLowerCase()] = val;\n                }\n            }\n            else if (attr === \"Released\") {\n                var val = new Date(obj[attr]);\n                if (isNaN(val.getTime())) {\n                    this.released = undefined;\n                }\n                else {\n                    this.released = val;\n                }\n            }\n            else if (attr === \"DVD\") {\n                var val = new Date(obj[attr]);\n                if (isNaN(val.getTime())) {\n                    this.dvd = undefined;\n                }\n                else {\n                    this.dvd = val;\n                }\n            }\n            else if (attr === \"imdbRating\") {\n                var key = transTable[attr];\n                var val = parseFloat(obj[attr]);\n                this[key] = isNaN(val) ? 0 : val;\n            }\n            else if (transTable[attr] !== undefined) {\n                this[transTable[attr]] = obj[attr];\n            }\n            else if (attr === \"Ratings\") {\n                for (var _b = 0, _c = obj[attr]; _b < _c.length; _b++) {\n                    var rating = _c[_b];\n                    this.ratings.push({ source: rating.Source, value: rating.Value });\n                }\n            }\n            else {\n                this[attr.toLowerCase()] = obj[attr];\n            }\n        }\n        this.name = this.title;\n        this.series = this.type !== \"movie\";\n        this.imdburl = \"https://www.imdb.com/title/\" + this.imdbid;\n    }\n    return Movie;\n}());\nexports.Movie = Movie;\nvar Episode = (function (_super) {\n    __extends(Episode, _super);\n    function Episode(obj, season) {\n        var _this = _super.call(this, obj) || this;\n        if (season !== undefined) {\n            _this.season = season;\n        }\n        else {\n            _this.season = parseInt(obj.Season, 10);\n            if (isNaN(_this.season)) {\n                throw new TypeError(\"invalid season\");\n            }\n        }\n        if (Object.prototype.hasOwnProperty.call(obj, \"Episode\")) {\n            _this.episode = parseInt(obj.Episode, 10);\n            if (isNaN(_this.episode)) {\n                throw new TypeError(\"invalid episode\");\n            }\n        }\n        return _this;\n    }\n    return Episode;\n}(Movie));\nexports.Episode = Episode;\nvar TVShow = (function (_super) {\n    __extends(TVShow, _super);\n    function TVShow(obj, opts) {\n        var _this = _super.call(this, obj) || this;\n        _this._episodes = [];\n        var years = _this._yearData.split(\"-\");\n        _this.start_year = parseInt(years[0], 10);\n        _this.end_year = parseInt(years[1], 10) ? parseInt(years[1], 10) : undefined;\n        _this.totalseasons = parseInt(obj.totalSeasons, 10);\n        _this.opts = opts;\n        return _this;\n    }\n    TVShow.prototype.episodes = function () {\n        if (this._episodes.length !== 0) {\n            return Promise.resolve(this._episodes);\n        }\n        var tvShow = this;\n        var funcs = [];\n        for (var i = 1; i <= tvShow.totalseasons; i++) {\n            var reqopts = {\n                searchParams: {\n                    Season: i,\n                    apikey: tvShow.opts.apiKey,\n                    i: tvShow.imdbid,\n                    r: \"json\",\n                },\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                },\n                timeout: undefined,\n            };\n            if (\"timeout\" in this.opts) {\n                reqopts.timeout = this.opts.timeout;\n            }\n            funcs.push(ky(omdbapi, reqopts).json());\n        }\n        var prom = Promise.all(funcs).then(function (epData) {\n            var eps = [];\n            for (var _i = 0, epData_1 = epData; _i < epData_1.length; _i++) {\n                var datum = epData_1[_i];\n                if (interfaces_1.isError(datum)) {\n                    throw new ImdbError(datum.Error);\n                }\n                var season = parseInt(datum.Season, 10);\n                for (var _a = 0, _b = Object.getOwnPropertyNames(datum.Episodes); _a < _b.length; _a++) {\n                    var ep = _b[_a];\n                    eps.push(new Episode(datum.Episodes[ep], season));\n                }\n            }\n            tvShow._episodes = eps;\n            return Promise.resolve(eps);\n        });\n        return prom;\n    };\n    return TVShow;\n}(Movie));\nexports.TVShow = TVShow;\nvar Game = (function (_super) {\n    __extends(Game, _super);\n    function Game() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return Game;\n}(Movie));\nexports.Game = Game;\nvar SearchResult = (function () {\n    function SearchResult(obj) {\n        for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n            var attr = _a[_i];\n            if (attr === \"Year\") {\n                this[attr.toLowerCase()] = parseInt(obj[attr], 10);\n            }\n            else {\n                this[attr.toLowerCase()] = obj[attr];\n            }\n        }\n        this.name = this.title;\n    }\n    return SearchResult;\n}());\nexports.SearchResult = SearchResult;\nvar SearchResults = (function () {\n    function SearchResults(obj, page, opts, req) {\n        this.results = [];\n        this.page = page;\n        this.req = req;\n        this.opts = opts;\n        for (var _i = 0, _a = Object.getOwnPropertyNames(obj); _i < _a.length; _i++) {\n            var attr = _a[_i];\n            if (attr === \"Search\") {\n                for (var _b = 0, _c = obj.Search; _b < _c.length; _b++) {\n                    var result = _c[_b];\n                    this.results.push(new SearchResult(result));\n                }\n            }\n            else if (attr === \"totalResults\") {\n                this[attr.toLowerCase()] = parseInt(obj[attr], 10);\n            }\n            else {\n                this[attr.toLowerCase()] = obj[attr];\n            }\n        }\n    }\n    SearchResults.prototype.next = function () {\n        return search(this.req, this.opts, this.page + 1);\n    };\n    return SearchResults;\n}());\nexports.SearchResults = SearchResults;\nvar ImdbError = (function () {\n    function ImdbError(message) {\n        this.message = message;\n        this.name = \"imdb api error\";\n    }\n    return ImdbError;\n}());\nexports.ImdbError = ImdbError;\nfunction get(req, opts) {\n    try {\n        return new Client(opts).get(req);\n    }\n    catch (e) {\n        return Promise.reject(e);\n    }\n}\nexports.get = get;\nfunction search(req, opts, page) {\n    return new Client(opts).search(req, page);\n}\nexports.search = search;\nvar Client = (function () {\n    function Client(opts) {\n        if (!Object.prototype.hasOwnProperty.call(opts, \"apiKey\")) {\n            throw new ImdbError(\"Missing api key in opts\");\n        }\n        this.opts = opts;\n    }\n    Client.prototype.get = function (req, opts) {\n        opts = this.mergeOpts(opts);\n        var qs = [\n            [\"apikey\", opts.apiKey],\n            [\"plot\", req.short_plot ? \"short\" : \"full\"],\n            [\"r\", \"json\"],\n        ];\n        if (req.year !== undefined) {\n            qs.push([\"y\", String(req.year)]);\n        }\n        if (req.name) {\n            qs.push([\"t\", req.name]);\n        }\n        else if (req.id) {\n            qs.push([\"i\", req.id]);\n        }\n        else {\n            return Promise.reject(new ImdbError(\"Missing one of req.id or req.name\"));\n        }\n        var reqopts = {\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            searchParams: qs,\n            timeout: undefined,\n        };\n        if (\"timeout\" in opts) {\n            reqopts.timeout = opts.timeout;\n        }\n        var prom = ky(omdbapi, reqopts)\n            .json()\n            .then(function (data) {\n            var ret;\n            if (interfaces_1.isError(data)) {\n                throw new ImdbError(data.Error + \": \" + (req.name ? req.name : req.id));\n            }\n            if (interfaces_1.isMovie(data)) {\n                ret = new Movie(data);\n            }\n            else if (interfaces_1.isGame(data)) {\n                ret = new Game(data);\n            }\n            else if (interfaces_1.isTvshow(data)) {\n                ret = new TVShow(data, opts);\n            }\n            else if (interfaces_1.isEpisode(data)) {\n                ret = new Episode(data);\n            }\n            else {\n                throw new ImdbError(\"type: '\" + data.Type + \"' is not valid\");\n            }\n            return Promise.resolve(ret);\n        });\n        return prom;\n    };\n    Client.prototype.search = function (req, page, opts) {\n        opts = this.mergeOpts(opts);\n        if (page === undefined) {\n            page = 1;\n        }\n        var qs = reqtoqueryobj(req, opts.apiKey, page);\n        var reqopts = {\n            searchParams: qs,\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            timeout: undefined,\n        };\n        if (\"timeout\" in opts) {\n            reqopts.timeout = opts.timeout;\n        }\n        var prom = ky(omdbapi, reqopts)\n            .json()\n            .then(function (data) {\n            if (interfaces_1.isError(data)) {\n                throw new ImdbError(data.Error + \": \" + req.name);\n            }\n            return Promise.resolve(new SearchResults(data, page, opts, req));\n        });\n        return prom;\n    };\n    Client.prototype.mergeOpts = function (opts) {\n        if (opts !== undefined) {\n            return __assign(__assign({}, this.opts), opts);\n        }\n        return __assign({}, this.opts);\n    };\n    return Client;\n}());\nexports.Client = Client;\n//# sourceMappingURL=imdb.js.map"]},"metadata":{},"sourceType":"script"}